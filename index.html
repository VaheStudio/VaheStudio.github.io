<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>开源社区论坛</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">
    <!-- 导航栏 -->
    <header class="bg-white shadow-md sticky top-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <img src="VaheStudio.png" alt="VaheStudio团队图标" class="h-10 w-10 rounded-lg">
                <h1 class="text-xl font-bold text-primary">开源社区论坛</h1>
            </div>
            
            <nav class="hidden md:flex items-center space-x-6">
                <a href="#home" class="font-medium hover:text-primary transition-colors">首页</a>
                <a href="#messages" class="font-medium hover:text-primary transition-colors">社区动态</a>
                <a href="#contact" class="font-medium hover:text-primary transition-colors">联系我们</a>
            </nav>
            
            <button id="mobileMenuBtn" class="md:hidden text-gray-600 focus:outline-none">
                <i class="fa fa-bars text-xl"></i>
            </button>
        </div>
        
        <!-- 移动端菜单 -->
        <div id="mobileMenu" class="hidden md:hidden bg-white border-t">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <a href="#home" class="py-2 font-medium hover:text-primary transition-colors">首页</a>
                <a href="#messages" class="py-2 font-medium hover:text-primary transition-colors">社区动态</a>
                <a href="#contact" class="py-2 font-medium hover:text-primary transition-colors">联系我们</a>
            </div>
        </div>
    </header>

    <!-- 主要内容 -->
    <main class="flex-grow">
        <!-- 英雄区域 -->
        <section id="home" class="bg-gradient-to-r from-primary to-blue-700 text-white py-16 md:py-24">
            <div class="container mx-auto px-4 text-center">
                <h2 class="text-3xl md:text-5xl font-bold mb-6 text-shadow">开源社区，人人可参与</h2>
                <p class="text-lg md:text-xl max-w-2xl mx-auto mb-8 opacity-90">
                    这是一个开放、免费的社区论坛，无需登录即可浏览所有内容。
                    在这里，你可以查看社区动态，获取最新资讯。
                </p>
                <a href="#messages" class="bg-white text-primary font-semibold px-6 py-3 rounded-lg shadow-lg hover:shadow-xl transition-all inline-flex items-center">
                    浏览社区动态
                    <i class="fa fa-arrow-right ml-2"></i>
                </a>
            </div>
        </section>

        <!-- 发布信息提示区 -->
        <section class="bg-yellow-50 py-6 border-b border-yellow-200">
            <div class="container mx-auto px-4 text-center">
                <p class="text-yellow-800 flex items-center justify-center">
                    <i class="fa fa-info-circle mr-2"></i>
                    如需发布信息，请联系管理员QQ: <strong class="ml-1">123456789</strong>
                </p>
            </div>
        </section>

        <!-- 社区动态区 -->
        <section id="messages" class="py-12 md:py-16 bg-gray-50">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-2xl md:text-3xl font-bold mb-4">社区动态</h2>
                    <p class="text-gray-600 max-w-2xl mx-auto">查看社区最新发布的信息和动态，所有内容均由管理员审核发布</p>
                </div>
                
                <!-- 筛选和搜索 -->
                <div class="mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex flex-wrap gap-2">
                        <button class="filter-btn active px-4 py-2 bg-primary text-white rounded-full text-sm font-medium" data-filter="all">全部</button>
                        <button class="filter-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm font-medium transition-colors" data-filter="announcement">公告</button>
                        <button class="filter-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm font-medium transition-colors" data-filter="discussion">讨论</button>
                        <button class="filter-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm font-medium transition-colors" data-filter="resource">资源分享</button>
                    </div>
                    <div class="relative w-full md:w-auto">
                        <input type="text" id="searchInput" placeholder="搜索内容..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 w-full md:w-64">
                        <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>
                
                <!-- 消息列表 -->
                <div id="messageContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- 消息将通过JavaScript动态加载 -->
                    <div class="col-span-full text-center py-12">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"></div>
                        <p class="text-gray-500">加载中...</p>
                    </div>
                </div>
                
                <!-- 无数据提示 -->
                <div id="noDataMessage" class="hidden col-span-full text-center py-16">
                    <i class="fa fa-inbox text-5xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500">暂无内容，请稍后再来查看</p>
                </div>
            </div>
        </section>

        <!-- 联系我们 -->
        <section id="contact" class="py-12 md:py-16 bg-white">
            <div class="container mx-auto px-4">
                <div class="max-w-3xl mx-auto">
                    <div class="text-center mb-10">
                        <h2 class="text-2xl md:text-3xl font-bold mb-4">联系我们</h2>
                        <p class="text-gray-600">有任何问题或建议，请通过以下方式联系管理员</p>
                    </div>
                    
                    <div class="bg-gray-50 rounded-xl shadow-sm p-6 md:p-8">
                        <div class="flex flex-col md:flex-row items-center gap-8">
                            <div class="flex-1 text-center md:text-left">
                                <div class="flex items-center justify-center md:justify-start mb-4">
                                    <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                                        <i class="fa fa-qq text-primary text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-lg">联系管理员</h3>
                                        <p class="text-gray-600">通过QQ沟通</p>
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg p-4 shadow-sm inline-block">
                                    <p class="text-lg font-medium">QQ: 123456789</p>
                                </div>
                            </div>
                            
                            <div class="h-px w-full md:w-px bg-gray-200 md:hidden"></div>
                            
                            <div class="flex-1">
                                <img src="https://picsum.photos/seed/qqcode/200/200" alt="管理员QQ二维码" class="rounded-lg shadow-md mx-auto md:mx-0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <img src="VaheStudio.png" alt="VaheStudio团队图标" class="h-8 w-8 rounded mr-2">
                    <span class="font-medium">VaheStudio</span>
                </div>
                
                <div class="text-gray-400 text-sm">
                    &copy; 2023 开源社区论坛 | 基于Github Pages部署
                </div>
                
                <div class="flex space-x-4 mt-4 md:mt-0">
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-github text-xl"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-twitter text-xl"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fa fa-envelope text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- 消息详情模态框 -->
    <div id="messageModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b">
                <div class="flex justify-between items-start">
                    <div>
                        <span id="modalCategory" class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-primary/10 text-primary mb-2"></span>
                        <h3 id="modalTitle" class="text-xl font-bold"></h3>
                    </div>
                    <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                <div class="flex items-center mt-2 text-gray-500 text-sm">
                    <i class="fa fa-user mr-1"></i>
                    <span id="modalAuthor"></span>
                    <span class="mx-2">•</span>
                    <i class="fa fa-clock-o mr-1"></i>
                    <span id="modalDate"></span>
                </div>
            </div>
            <div id="modalContent" class="p-6">
                <!-- 内容将通过JavaScript动态加载 -->
            </div>
            <div class="p-6 border-t flex justify-end">
                <button id="closeModalBtn" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg font-medium transition-colors">
                    关闭
                </button>
            </div>
        </div>
    </div>

    <script>
        // 移动端菜单切换
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
        
        // 导航栏滚动效果
        window.addEventListener('scroll', () => {
            const header = document.querySelector('header');
            if (window.scrollY > 10) {
                header.classList.add('py-2');
                header.classList.remove('py-3');
            } else {
                header.classList.add('py-3');
                header.classList.remove('py-2');
            }
        });
        
        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                // 关闭移动菜单（如果打开）
                mobileMenu.classList.add('hidden');
                
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
        
        // 加载消息数据
        async function loadMessages() {
            const messageContainer = document.getElementById('messageContainer');
            const noDataMessage = document.getElementById('noDataMessage');
            
            try {
                // 尝试从message.json加载数据
                const response = await fetch('message.json');
                
                if (!response.ok) {
                    throw new Error('无法加载数据');
                }
                
                const messages = await response.json();
                
                // 清空加载状态
                messageContainer.innerHTML = '';
                
                if (messages.length === 0) {
                    // 显示无数据提示
                    noDataMessage.classList.remove('hidden');
                    return;
                }
                
                // 隐藏无数据提示
                noDataMessage.classList.add('hidden');
                
                // 按日期降序排序（最新的在前）
                messages.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // 渲染消息
                messages.forEach(message => {
                    const messageCard = createMessageCard(message);
                    messageContainer.appendChild(messageCard);
                });
                
                // 添加消息点击事件
                document.querySelectorAll('.message-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const messageId = card.dataset.id;
                        openMessageModal(messages.find(m => m.id === messageId));
                    });
                });
                
                // 初始化筛选功能
                initFilters(messages);
                
            } catch (error) {
                console.error('加载消息失败:', error);
                messageContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fa fa-exclamation-triangle text-4xl text-yellow-500 mb-4"></i>
                        <p class="text-gray-500">加载数据失败，请稍后重试</p>
                    </div>
                `;
            }
        }
        
        // 创建消息卡片
        function createMessageCard(message) {
            const card = document.createElement('div');
            card.className = `message-card card-hover bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100 cursor-pointer`;
            card.dataset.id = message.id;
            card.dataset.category = message.category;
            
            // 格式化日期
            const formattedDate = new Date(message.date).toLocaleString('zh-CN', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            // 截取部分内容作为预览
            const previewText = message.content.length > 100 
                ? message.content.substring(0, 100) + '...' 
                : message.content;
            
            // 分类样式映射
            const categoryStyles = {
                'announcement': { bg: 'bg-red-100', text: 'text-red-600', icon: 'fa-bullhorn' },
                'discussion': { bg: 'bg-blue-100', text: 'text-blue-600', icon: 'fa-comments' },
                'resource': { bg: 'bg-green-100', text: 'text-green-600', icon: 'fa-share-alt' }
            };
            
            const style = categoryStyles[message.category] || categoryStyles['discussion'];
            
            card.innerHTML = `
                ${message.images && message.images.length > 0 ? `
                    <div class="h-48 overflow-hidden">
                        <img src="image/${message.images[0]}" alt="${message.title}的图片" class="w-full h-full object-cover transition-transform duration-500 hover:scale-105">
                    </div>
                ` : ''}
                <div class="p-5">
                    <div class="flex justify-between items-start mb-3">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${style.bg} ${style.text}">
                            <i class="fa ${style.icon} mr-1"></i>${getCategoryName(message.category)}
                        </span>
                        <span class="text-gray-500 text-sm">${formattedDate}</span>
                    </div>
                    <h3 class="font-bold text-lg mb-2 line-clamp-2">${message.title}</h3>
                    <p class="text-gray-600 text-sm mb-4 line-clamp-3">${previewText}</p>
                    <div class="flex justify-between items-center">
                        <div class="flex items-center text-gray-500 text-sm">
                            <i class="fa fa-user mr-1"></i>
                            <span>${message.author}</span>
                        </div>
                        ${message.images && message.images.length > 0 ? `
                            <div class="flex items-center text-gray-500 text-sm">
                                <i class="fa fa-picture-o mr-1"></i>
                                <span>${message.images.length}张图片</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // 获取分类名称
        function getCategoryName(category) {
            const names = {
                'announcement': '公告',
                'discussion': '讨论',
                'resource': '资源分享'
            };
            return names[category] || category;
        }
        
        // 打开消息详情模态框
        function openMessageModal(message) {
            const modal = document.getElementById('messageModal');
            const modalCategory = document.getElementById('modalCategory');
            const modalTitle = document.getElementById('modalTitle');
            const modalAuthor = document.getElementById('modalAuthor');
            const modalDate = document.getElementById('modalDate');
            const modalContent = document.getElementById('modalContent');
            
            // 设置模态框内容
            modalCategory.textContent = getCategoryName(message.category);
            modalTitle.textContent = message.title;
            modalAuthor.textContent = message.author;
            modalDate.textContent = new Date(message.date).toLocaleString('zh-CN');
            
            // 处理内容和图片
            let contentHtml = `<div class="prose max-w-none">${formatTextWithLineBreaks(message.content)}</div>`;
            
            // 如果有图片，添加图片展示
            if (message.images && message.images.length > 0) {
                contentHtml += `
                    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${message.images.map(img => `
                            <div class="rounded-lg overflow-hidden border border-gray-100">
                                <img src="image/${img}" alt="消息图片" class="w-full h-auto hover:scale-105 transition-transform duration-300 cursor-zoom-in">
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            modalContent.innerHTML = contentHtml;
            
            // 显示模态框
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // 防止背景滚动
        }
        
        // 关闭模态框
        function closeModal() {
            const modal = document.getElementById('messageModal');
            modal.classList.add('hidden');
            document.body.style.overflow = ''; // 恢复滚动
        }
        
        // 格式化文本，将换行符转换为<br>
        function formatTextWithLineBreaks(text) {
            return text.replace(/\n/g, '<br>');
        }
        
        // 初始化筛选功能
        function initFilters(messages) {
            const filterButtons = document.querySelectorAll('.filter-btn');
            const searchInput = document.getElementById('searchInput');
            let currentFilter = 'all';
            let currentSearch = '';
            
            // 筛选按钮点击事件
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // 更新按钮样式
                    filterButtons.forEach(btn => {
                        btn.classList.remove('active', 'bg-primary', 'text-white');
                        btn.classList.add('bg-gray-200', 'hover:bg-gray-300');
                    });
                    button.classList.add('active', 'bg-primary', 'text-white');
                    button.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                    
                    currentFilter = button.dataset.filter;
                    applyFilters();
                });
            });
            
            // 搜索输入事件
            searchInput.addEventListener('input', () => {
                currentSearch = searchInput.value.toLowerCase();
                applyFilters();
            });
            
            // 应用筛选
            function applyFilters() {
                const messageCards = document.querySelectorAll('.message-card');
                
                messageCards.forEach(card => {
                    const category = card.dataset.category;
                    const title = card.querySelector('h3').textContent.toLowerCase();
                    const content = card.querySelector('p').textContent.toLowerCase();
                    
                    const categoryMatch = currentFilter === 'all' || category === currentFilter;
                    const searchMatch = currentSearch === '' || 
                                       title.includes(currentSearch) || 
                                       content.includes(currentSearch);
                    
                    if (categoryMatch && searchMatch) {
                        card.classList.remove('hidden');
                    } else {
                        card.classList.add('hidden');
                    }
                });
                
                // 检查是否有可见的卡片
                const visibleCards = document.querySelectorAll('.message-card:not(.hidden)');
                const noDataMessage = document.getElementById('noDataMessage');
                
                if (visibleCards.length === 0) {
                    noDataMessage.classList.remove('hidden');
                } else {
                    noDataMessage.classList.add('hidden');
                }
            }
        }
        
        // 关闭模态框事件
        document.getElementById('closeModal').addEventListener('click', closeModal);
        document.getElementById('closeModalBtn').addEventListener('click', closeModal);
        
        // 点击模态框外部关闭
        document.getElementById('messageModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('messageModal')) {
                closeModal();
            }
        });
        
        // 页面加载完成后加载消息
        document.addEventListener('DOMContentLoaded', loadMessages);
    </script>
</body>
</html>
